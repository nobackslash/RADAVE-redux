<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RADAVE - Registro de Paciente</title>
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <header id="header"></header>
    <main id="main-container">
      <h1>Registro de Paciente</h1>
      <form id="patient-form">
        <div class="form-group">
          <label for="p_name">Nome do Paciente:</label>
          <input
            type="text"
            id="p_name"
            name="p_name"
            maxlength="50"
            required
          />
        </div>

        <div class="form-group">
          <label for="p_birth">Data de Nascimento:</label>
          <input
            type="date"
            id="p_birth"
            name="date-birth"
            min="1900-01-01"
            required
          />
        </div>

        <div class="form-group">
          <label for="p_dtavc">Data do AVC:</label>
          <input
            type="date"
            id="p_dtavc"
            name="date-avc"
            min="2000-01-01"
            required
          />
        </div>

        <div class="form-group">
          <label for="p_injure">Local da lesão:</label>
          <select id="p_injure" name="locallesao" required>
            <option value="">Selecione</option>
            <option value="Hemisfério direito">Hemisfério direito</option>
            <option value="Hemisfério esquerdo">Hemisfério esquerdo</option>
            <option value="Bilateral">Bilateral</option>
            <option value="Tronco cerebral">Tronco cerebral</option>
            <option value="Sem especificações">Sem especificações</option>
            <option value="Outros">Outros</option>
          </select>
        </div>

        <div class="form-group">
          <label for="p_gender">Sexo:</label>
          <select id="p_gender" name="gender" required>
            <option value="">Selecione</option>
            <option value="masculino">Masculino</option>
            <option value="feminino">Feminino</option>
          </select>
        </div>

        <div class="form-group">
          <label for="p_place">Unidade de Aplicação:</label>
          <select id="p_place" name="unit" required>
            <option value="">Selecione</option>
            <option value="Centro de Reabilitação">
              Centro de Reabilitação
            </option>
            <option value="Enfermaria">Enfermaria</option>
            <option value="UBS">UBS</option>
            <option value="Pronto Socorro">Pronto Socorro</option>
            <option value="Unidade de AVC">Unidade de AVC</option>
            <option value="UTI">UTI</option>
          </select>
        </div>

        <button type="submit" class="primary-button">Iniciar Avaliação</button>
      </form>
    </main>

    <footer id="footer"></footer>
    <script src="../js/layout.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("patient-form");

        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const p_name = document.getElementById("p_name").value.trim();
          const p_birth = document.getElementById("p_birth").value;
          const p_dtavc = document.getElementById("p_dtavc").value;
          const p_injure = document.getElementById("p_injure").value;
          const p_gender = document.getElementById("p_gender").value;
          const p_place = document.getElementById("p_place").value;

          // compute age from birthdate
          let age = null;
          if (p_birth) {
            const b = new Date(p_birth);
            const today = new Date();
            age = today.getFullYear() - b.getFullYear();
            const m = today.getMonth() - b.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < b.getDate())) {
              age--;
            }
          }
          // save all the session data
          sessionStorage.setItem("p_name", p_name || "");
          if (age !== null) sessionStorage.setItem("p_age", String(age));
          sessionStorage.setItem("p_dtavc", p_dtavc || "");
          sessionStorage.setItem("p_injure", p_injure || "");
          sessionStorage.setItem("p_gender", p_gender || "");
          sessionStorage.setItem("p_place", p_place || "");

          // proceed to quiz 1
          window.location.href = "quiz/p1.html";
        });
      });
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>RADAVE</title>
        <link rel="stylesheet" href="css/styles.css" />
    </head>
    <body>
        <div data-include="partials/header.html"></div>

        <main id="main-container">
            <div id="quiz-container">
                <h1 class="pos2">
                    Rastreamento para a disfagia no acidente vascular encefálico
                </h1>
                <div id="user-info">
                    <h3 style="text-align: center; color: rgb(71, 71, 71)">
                        Informações do Paciente
                    </h3>
                    <br />
                    <label for="name">Nome:</label>
                    <input type="text" id="name" maxlength="50" required />

                    <label for="age">Idade:</label>
                    <input
                        type="number"
                        id="age"
                        min="0"
                        max="101"
                        required
                        oninput="this.value = this.value.slice(0, 3);"
                    />
                    <label for="age">Data do AVC:</label>
                    <input
                        type="date"
                        id="date-avc"
                        required
                        min="2000-01-01"
                        max="2025-12-31"
                    />

                    <label for="locallesao">Local da lesão:</label>
                    <select id="locallesao" required>
                        <option value="">Selecione</option>
                        <option value="Hemisfério direito">
                            Hemisfério direito
                        </option>
                        <option value="Hemisfério esquerdo">
                            Hemisfério esquerdo
                        </option>
                        <option value="Bilateral">Bilateral</option>
                        <option value="Tronco cerebral">Tronco cerebral</option>
                        <option value="Sem especificações">
                            Sem especificações
                        </option>
                        <option value="Outros">Outros</option>
                    </select>

                    <label for="gender">Gênero:</label>
                    <select id="gender" required>
                        <option value="">Selecione</option>
                        <option value="masculino">Masculino</option>
                        <option value="feminino">Feminino</option>
                    </select>

                    <label for="unit">Unidade de Aplicação:</label>
                    <select id="unit" required>
                        <option value="">Selecione</option>
                        <option value="Centro de Reabilitação">
                            Centro de Reabilitação
                        </option>
                        <option value="Enfermaria">Enfermaria</option>
                        <option value="UBS ">UBS</option>
                        <option value="Pronto Socorro">Pronto Socorro</option>
                        <option value="Unidade de AVC">Unidade de AVC</option>
                        <option value="UTI">UTI</option>
                    </select>

                    <button id="start-button">Iniciar Questionário</button>
                </div>

                <form id="quiz-form" style="display: none">
                    <div id="user-summary" style="display: none">
                        <!-- Resumo do usuário antes da pergunta -->
                        <h2>Informações do Paciente</h2>
                        <p>
                            <strong>Nome:</strong>
                            <span id="summary-name"></span>
                        </p>
                        <p>
                            <strong>Idade:</strong>
                            <span id="summary-age"></span>
                        </p>
                        <p>
                            <strong>Data do AVC:</strong>
                            <span id="summary-date-avc"></span>
                        </p>
                        <p>
                            <strong>Gênero:</strong>
                            <span id="summary-gender"></span>
                        </p>
                    </div>

                    <!-- Perguntas -->
                    <div id="step-1" class="step">
                        <h2>Etapa 1 - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Chame o
                            paciente pelo nome e observe.
                        </p>
                        <br />
                        <h1>1. Apresenta dificuldade de manter-se acordado?</h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Não responde,
                            sonolento, necessitando de estímulos verbais e
                            táteis para se manter alerta
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q1" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q1" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q1" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-2" class="step" style="display: none">
                        <h2>Etapa 1 - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Pergunte ao
                            paciente, acompanhe ou cheque o prontuário
                        </p>
                        <br />
                        <h1>
                            2. Apresenta histórico de dificuldade de deglutição?
                        </h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Engasgos,
                            tosses durante a alimentação, uso de via alternativa
                            de alimentação, necessidade de adaptação da dieta
                            previamente
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q2" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q2" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q2" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-3" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Posture o
                            paciente sentado com o decúbito elevado
                        </p>
                        <br />
                        <h1>
                            3. Apresenta dificuldade de manter-se sentado com
                            apoio e com a cabeça reta?
                        </h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Não mantém
                            controle da cabeça e/ou de tronco mesmo que apoiado.
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q3" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q3" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q3" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-4" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Observe a voz
                            do paciente durante a conversa
                        </p>
                        <br />
                        <h1>4. Apresenta alteração na voz?</h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Voz rouca,
                            sem sonorização ou pouca sonorização.
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q4" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q4" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q4" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-5" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Observe a
                            fala e linguagem do paciente durante a conversa
                            espontânea
                        </p>
                        <br />
                        <h1>
                            5. Apresenta dificuldade na fala e/ou linguagem?
                        </h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Não fala,
                            fala arrastada, alteração na articulação
                            (disartria), dificuldade para compreender o
                            discurso, expressões orais fragmentadas, discurso
                            incoerente
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q5" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q5" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q5" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-6" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Observe a
                            face no repouso e solicite bico e sorriso
                        </p>
                        <br />
                        <h1>6. Apresenta assimetria facial?</h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Redução ou
                            ausência total do movimento de um dos lados da face.
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q6" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q6" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q6" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-7" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Solicite que
                            o paciente mexa os lábios e a língua
                        </p>
                        <br />
                        <h1>
                            7. Apresenta dificuldade de movimentar lábios e
                            língua?
                        </h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Não apresenta
                            movimento, movimento lentificado, desvio do
                            movimento.
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q7" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q7" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q7" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <div id="step-8" class="step" style="display: none">
                        <h2>Etapa I - FATORES PREDITIVOS DE RISCO</h2>
                        <p>
                            <strong>Instrução Enfermaria:</strong> Observe se o
                            paciente engole a saliva(movimento de subida
                            laringe) espontaneamente o sob comando
                        </p>
                        <br />
                        <h1>
                            8. Apresenta dificuldade de engolir e gerenciar a
                            deglutição de saliva/secreções espontaneamente ou
                            sob comando?
                        </h1>
                        <p>
                            <strong>Possíveis alterações:</strong> Não observa
                            deglutição, acúmulo de saliva na cavidade oral,
                            baba, voz molhada, ruídos em via aérea alta.
                        </p>
                        <br /><br />
                        <label>
                            <input type="radio" name="q8" value="1" />
                            Sim </label
                        ><br />
                        <label>
                            <input type="radio" name="q8" value="0" />
                            Não </label
                        ><br />
                        <label>
                            <input type="radio" name="q8" value="-1" /> Não se
                            aplica
                        </label>
                    </div>
                    <button
                        type="button"
                        id="next-button"
                        style="display: none"
                    >
                        Próxima Pergunta
                    </button>
                    <button
                        type="submit"
                        id="submit-button"
                        style="display: none"
                    >
                        Enviar
                    </button>
                </form>
            </div>
        </main>

        <div data-include="partials/footer.html"></div>

        <script>
            const startButton = document.getElementById("start-button");
            const quizForm = document.getElementById("quiz-form");
            const userInfo = document.getElementById("user-info");
            const nextButton = document.getElementById("next-button");
            const submitButton = document.getElementById("submit-button");
            const userSummary = document.getElementById("user-summary");
            const steps = document.querySelectorAll(".step");
            let currentStep = 0;
            let score = 0; // Variável para acumular a pontuação

            // Função para formatar a data de AAAA-MM-DD para DD/MM/AAAA
            function formatDate(dateString) {
                const dateParts = dateString.split("-");
                return `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
            }

            startButton.addEventListener("click", () => {
                const name = document.getElementById("name").value;
                const age = document.getElementById("age").value;
                const dateAvc = document.getElementById("date-avc").value;
                const gender = document.getElementById("gender").value;
                const locallesao = document.getElementById("locallesao").value;
                const unit = document.getElementById("unit").value;

                if (name && age && dateAvc && gender && locallesao && unit) {
                    // Exibe as informações no sumário com a data formatada
                    document.getElementById("summary-name").textContent = name;
                    document.getElementById("summary-age").textContent = age;
                    document.getElementById("summary-date-avc").textContent =
                        formatDate(dateAvc);
                    document.getElementById("summary-gender").textContent =
                        gender;

                    // Armazena as informações no localStorage para continuar na Etapa 2
                    localStorage.setItem("name", name);
                    localStorage.setItem("age", age);
                    localStorage.setItem("dateAvc", dateAvc);
                    localStorage.setItem("gender", gender);
                    localStorage.setItem("locallesao", locallesao);
                    localStorage.setItem("unit", unit);

                    userInfo.style.display = "none";
                    quizForm.style.display = "block";
                    userSummary.style.display = "block";
                    steps[currentStep].style.display = "block";
                    nextButton.style.display = "block";

                    // Adiciona o listener para armazenar as respostas selecionadas
                    document
                        .querySelectorAll('input[type="radio"]')
                        .forEach((input) => {
                            input.addEventListener("change", () => {
                                const questionId = input.name;
                                const selectedValue = input.value;

                                // Verifica se o input está selecionado
                                if (input.checked) {
                                    localStorage.setItem(
                                        questionId,
                                        selectedValue
                                    ); // Armazena a resposta
                                } else {
                                    localStorage.setItem(
                                        questionId,
                                        "não respondida"
                                    ); // Armazena "não respondida"
                                }
                            });
                        });
                } else {
                    alert("Por favor, preencha todas as informações.");
                }
            });

            nextButton.addEventListener("click", () => {
                const currentQuestion = steps[currentStep];
                const selectedOption = currentQuestion.querySelector(
                    'input[type="radio"]:checked'
                );

                // Verifica se uma opção foi selecionada
                if (selectedOption) {
                    // Adiciona à pontuação se a resposta for "Sim" (valor 1) e só se for SIM
                    if (selectedOption.value === "1") {
                        score += parseInt(selectedOption.value); // Acumula a pontuação
                    }

                    // Armazena a pontuação no localStorage para continuar na Etapa 2
                    localStorage.setItem("score", score);

                    // Verifica se a pontuação é maior que 1
                    if (score > 1) {
                        // Aplica a classe para o efeito visual
                        document.body.classList.add("fade-out");

                        // Armazena as respostas das perguntas não respondidas como "não respondida"
                        for (let i = currentStep + 1; i < steps.length; i++) {
                            const nextQuestionId = steps[i].querySelector(
                                'input[type="radio"]'
                            ).name;
                            localStorage.setItem(
                                nextQuestionId,
                                "não respondida"
                            );
                        }

                        // Aguarda a transição antes de redirecionar
                        setTimeout(() => {
                            window.location.href = "alert_danger.html";
                        }, 500); // Tempo igual à animação CSS
                    }

                    // Lógica para o questionário
                    currentQuestion.style.display = "none"; // Esconde a pergunta atual
                    currentStep++; // Avança para a próxima pergunta

                    // Verifica se chegou à pergunta 9
                    if (currentStep === 8) {
                        // Verifica se a pontuação total até a pergunta 8 é menor que 2
                        if (score < 2) {
                            // Aplica a animação de saída antes da mudança de tela
                            document.body.classList.add("fade-out");

                            // Armazena as respostas das perguntas não respondidas como "não respondida"
                            for (
                                let i = currentStep + 1;
                                i < steps.length;
                                i++
                            ) {
                                const nextQuestionId = steps[i].querySelector(
                                    'input[type="radio"]'
                                ).name;
                                localStorage.setItem(
                                    nextQuestionId,
                                    "não respondida"
                                );
                            }

                            // Aguarda a transição antes de redirecionar
                            setTimeout(() => {
                                window.location.href = "alert_next.html";
                            }, 500); // Tempo da animação
                        } else {
                            // Aplica a animação antes do redirecionamento para alert.html
                            document.body.classList.add("fade-out");

                            setTimeout(() => {
                                window.location.href = "alert_ok.html";
                            }, 500);
                        }
                    } else if (currentStep < steps.length) {
                        steps[currentStep].style.display = "block"; // Mostra a próxima pergunta
                    }
                } else {
                    alert("Por favor, selecione uma opção para continuar.");
                }
            });

            quizForm.addEventListener("submit", (e) => {
                e.preventDefault();
                alert("Questionário enviado!");
            });
        </script>
    </body>
</html>
